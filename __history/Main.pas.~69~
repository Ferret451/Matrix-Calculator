unit Main;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Menus, System.Actions,
  Vcl.ActnList, Vcl.ExtCtrls,
  ExprCalculate, SingleLinkedList, Matrix;

type
  TMainForm = class(TForm)
    MainMenu: TMainMenu;
    File1: TMenuItem;
    Open1: TMenuItem;
    Close1: TMenuItem;
    SaveAs1: TMenuItem;
    edMatrixExpression: TEdit;
    shHistoryBorder: TShape;
    Panel1: TPanel;
    butTwo: TButton;
    butFive: TButton;
    butThree: TButton;
    butSix: TButton;
    butOne: TButton;
    butFour: TButton;
    butEight: TButton;
    butSeven: TButton;
    butNine: TButton;
    butZero: TButton;
    butComma: TButton;
    butDelete: TButton;
    butCalculate: TButton;
    butPlus: TButton;
    butMinus: TButton;
    butMultiplication: TButton;
    butDivision: TButton;
    butOpenBrace: TButton;
    butCloseBrace: TButton;
    butClear: TButton;
    procedure FormCreate(Sender: TObject);
    procedure edMatrixExpressionExit(Sender: TObject);
    procedure butCalculateClick(Sender: TObject);
    procedure butInputClick(Sender: TObject);
    procedure butDeleteClick(Sender: TObject);
    procedure butClearClick(Sender: TObject);

  private
    CursPos: Integer;

  public

  end;

var
  MainForm: TMainForm;
  MatrixesList: TSingleLinkedList<TMatrix>;

implementation

{$R *.dfm}

procedure TMainForm.FormCreate(Sender: TObject);
begin
  CursPos := 1;
end;

procedure TMainForm.edMatrixExpressionExit(Sender: TObject);
begin
  CursPos := EdMatrixExpression.SelStart;
end;

procedure TMainForm.butDeleteClick(Sender: TObject);
begin
  if Cursor > 1 then
  begin
    EdMatrixExpression.Text := Copy(EdMatrixExpression.Text, 1, CursPos - 1) + Copy(EdMatrixExpression.Text, CursPos + 1);
    dec(CursPos);
  end;
  EdMatrixExpression.SetFocus;
  EdMatrixExpression.SelStart := CursPos;
end;

procedure TMainForm.butCalculateClick(Sender: TObject);
begin
  EdMatrixExpression.Text := ExprCalculation(EdMatrixExpression.Text);
end;

procedure TMainForm.butClearClick(Sender: TObject);
begin
  EdMatrixExpression.Text := '';
  CursPos := 1;

  EdMatrixExpression.SetFocus;
  EdMatrixExpression.SelStart := CursPos;
end;

procedure TMainForm.butInputClick(Sender: TObject);
begin
  EdMatrixExpression.Text := Copy(EdMatrixExpression.Text, 1, CursPos) + (Sender as TButton).Caption + Copy(EdMatrixExpression.Text, CursPos + 1);
  inc(CursPos);

  EdMatrixExpression.SetFocus;
  EdMatrixExpression.SelStart := CursPos;
end;

end.
